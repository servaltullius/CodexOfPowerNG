# Codex of Power NG v1.0.7-rc.18 (2026-02-20, Pre-release)

## 요약
최근 등록 아이템 되돌리기(Undo) 기능을 추가하고, 세이브 로드 직후 보상 수치가 비정상적으로 보이던 경로를 안정화했습니다.
특히 Undo 이력 로드 시 FormID 해석과 보상 롤백 정합성을 강화해 수치 튐/불일치 가능성을 낮췄습니다.

## 주요 변경점
- Prisma UI에 `Undo` 탭 추가 (최근 등록 최대 10개 표시, 최신 1개만 되돌리기 허용)
- Undo 실행 시 등록 해제 + 아이템 복구 + 해당 등록에서 발생한 보상 델타 롤백 처리
- Undo 이력을 co-save(`UNDO`)로 저장/로드하도록 직렬화 경로 확장
- 세이브 로드 시 Undo 항목의 `regKey/formId`를 `ResolveFormID`로 재해석하도록 개선
- 보상 롤백 시 요청 델타 고정 적용이 아니라 실제 클램프 반영량(`next - previousTotal`)을 적용하도록 수정

## 사용자 영향
- 잘못 등록한 아이템을 인게임에서 바로 되돌릴 수 있습니다(최신 등록만).
- 로드 이후 치명타 확률/저항/소지무게 등 보상 수치가 내부 상태와 어긋날 가능성이 줄어듭니다.
- 기존 등록/보상 시스템의 기본 동작 방식은 유지됩니다.

## 기술 변경 상세
- UI/브리지
  - `PrismaUI/views/codexofpowerng/index.html`
  - `PrismaUI/views/codexofpowerng/ui_wiring.js`
  - `PrismaUI/views/codexofpowerng/input_shortcuts.js`
  - `PrismaUI/views/codexofpowerng/interop_bridge.js`
- 요청/페이로드/등록 로직
  - `src/PrismaUIRequests.cpp`
  - `src/PrismaUIRequestOps.cpp`
  - `src/PrismaUIPayloadsInventory.cpp`
  - `src/RegistrationQuickRegister.cpp`
  - `src/RegistrationUndo.cpp`
  - `src/RegistrationStateStore.cpp`
- 상태/직렬화/보상 정합성
  - `include/CodexOfPowerNG/State.h`
  - `src/SerializationSave.cpp`
  - `src/SerializationLoad.cpp`
  - `src/Rewards.cpp`
- 계약/로컬라이즈/테스트
  - `docs/contracts/prismaui-js-api.md`
  - `SKSE/Plugins/CodexOfPowerNG/lang/en.json`
  - `SKSE/Plugins/CodexOfPowerNG/lang/ko.json`
  - `tests/undo_registration_flow.test.cjs` 외 관련 JS/CPP 테스트 보강

## 검증
- `node --test tests/*.cjs` : PASS (70/70)
- `node --test tests/undo_registration_flow.test.cjs` : PASS (6/6)
- `cmake --preset wsl-release` : PASS
- `cmake --build --preset wsl-release` : PASS

## 호환성/주의사항
- 본 프로젝트는 기존 Codex of Power/SVCollection 세이브와 호환을 목표로 하지 않습니다.
- Undo 정책상 보상 일관성을 위해 "최신 등록"만 되돌릴 수 있습니다.
- C++ 단독 테스트(`ctest`)는 WSL cross 환경에서 wine runtime 상태에 따라 실행되지 않을 수 있습니다.

## 패키지
- 배포 파일: `releases/Codex of Power NG.zip`
- 태그: `v1.0.7-rc.18`
- 릴리즈: https://github.com/servaltullius/CodexOfPowerNG/releases/tag/v1.0.7-rc.18
