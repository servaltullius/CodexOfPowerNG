# Codex of Power NG v1.0.7 (2026-02-20)

## 요약
세이브 로드 안정성과 설정 반영 우선순위를 보강한 안정화 정식 릴리즈입니다.
로드 실패 시 부분 반영으로 상태가 꼬이는 문제를 막고, 입력 스케일은 모드 설정 파일 값을 항상 우선 적용하도록 정리했습니다.

## 주요 변경점
- Serialization Load를 원자적(atomic) 방식으로 전환
- Undo 이력 로드 시 `formId/regKey` 둘 중 하나라도 해석 실패하면 해당 엔트리 스킵
- UI `uiInputScale` 반영 우선순위를 설정 파일 우선으로 고정
- 등록/Undo 후 인벤토리 페이지가 1페이지로 튀는 동작 수정(마지막 요청 페이지 유지)

## 사용자 영향
- 손상/불완전 레코드가 있을 때 부분 상태 반영으로 인한 꼬임 가능성이 줄어듭니다.
- 입력 스케일은 저장된 모드 설정값대로 일관되게 반영됩니다.
- 등록/되돌리기 후에도 Quick Register 페이지/페이지 사이즈가 유지됩니다.

## 기술 변경 상세
- `src/SerializationLoad.cpp`
  - 임시 로드 버퍼(`loaded*`)에 파싱 후 마지막에 상태 커밋
  - Undo 로드 시 `ResolveFormID` 완전 성공 엔트리만 채택
- `src/PrismaUIRequestOps.cpp`
  - 마지막 인벤토리 요청(page/pageSize) 스냅샷 보관
  - register/undo 완료 후 `SnapshotLastInventoryRequest()`로 재요청
- `PrismaUI/views/codexofpowerng/index.html`
  - `uiInputScale`를 settings payload에서 항상 적용
  - localStorage 플래그가 settings 반영을 막지 않도록 조정
- 테스트
  - `tests/serialization_load_atomicity.test.cjs` 추가
  - `tests/undo_registration_flow.test.cjs` 보강
  - `tests/settings_payload_validation.test.cjs` 보강

## 검증
- `node --test tests/undo_registration_flow.test.cjs tests/settings_payload_validation.test.cjs tests/serialization_load_atomicity.test.cjs` : PASS
- `node --test tests/*.cjs` : PASS (72/72)
- `cmake --build --preset wsl-release` : PASS

## 호환성/주의사항
- 본 프로젝트는 구 버전 Codex of Power/SVCollection 세이브 마이그레이션을 목표로 하지 않습니다.
- Undo 엔트리는 안전성 우선 정책으로 해석 불가 FormID가 있으면 스킵됩니다.
- WSL cross 환경의 `ctest`는 wine runtime 환경 상태에 따라 실행 제약이 있을 수 있습니다.

## 패키지
- 배포 파일: `releases/Codex of Power NG.zip`
- 태그: `v1.0.7`
- 릴리즈: https://github.com/servaltullius/CodexOfPowerNG/releases/tag/v1.0.7
