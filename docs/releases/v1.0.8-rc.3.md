# Codex of Power NG v1.0.8-rc.3 (2026-02-22, Pre-release)

## 요약
이번 프리릴리즈는 설정 저장/Prisma UI/작업 큐/로그 경로에서 예외 또는 정리 누락으로 인해 발생할 수 있는 프리징/크래시 가능성을 낮추는 안정화 업데이트입니다.

## 주요 변경점
- `settings.user.json` 저장을 `.tmp` + rename 기반 **원자적(atomic) 저장**으로 변경하고, `.bak` 백업을 유지하도록 개선
- 시작 시점에 `settings.user.json.tmp/.bak` 잔여물이 남아있는 경우를 **자동 복구/정리**하도록 추가
- Prisma UI JS interop payload 직렬화(`payload.dump()`) 예외를 방어하여 `noexcept` 경로에서의 비정상 종료 위험 완화
- PreLoadGame 경계에서 Prisma UI FocusMenu/커서/뷰를 **강제 정리**하여 로드 경계에서 커서/포커스가 남는 케이스 완화
- queued task 실행을 `try/catch`로 감싸 **작업 큐 예외로 인한 프로세스 종료** 가능성 완화
- verbose(info) 로그에 대해 flush를 강제하지 않도록 조정하여 I/O 스톨 가능성 감소
- exclude patch 스캔에서 throwing `std::filesystem::exists()` 사용을 제거

## 사용자 영향
- 설정 저장 중 강제 종료/크래시가 발생하더라도 `settings.user.json` 파일이 부분 기록으로 깨질 가능성이 줄어듭니다.
- 로드/프리로드 경계에서 UI 커서가 남거나 입력이 먹통처럼 느껴지는 증상이 일부 환경에서 완화될 수 있습니다.
- 로그 flush 정책 변경으로, 크래시 직전의 `info` 로그 일부가 파일에 남지 않을 수 있습니다(대신 스톨 위험 완화).

## 기술 변경 상세
- 설정 저장/복구:
  - `src/Config.cpp`
- 작업 큐 예외 가드:
  - `src/TaskScheduler.cpp`
- Prisma UI 안정화(interop/late acquire/PreLoad cleanup):
  - `src/PrismaUIViewLifecycle.cpp`
  - `src/PrismaUIViewWorkers.cpp`
  - `src/PrismaUIManager.cpp`
  - `src/PrismaUIInternal.h`
- 로그 flush 정책:
  - `src/main.cpp`
- exclude patch 스캔의 non-throwing exists:
  - `src/RegistrationMaps.cpp`
- WSL cross-build ctest 안정화(wine64 선호):
  - `CMakeLists.txt`
- 회귀 테스트(Node):
  - `tests/config_atomic_save.test.cjs`
  - `tests/config_settings_repair_on_load.test.cjs`
  - `tests/prismaui_interop_dump_guard.test.cjs`
  - `tests/task_scheduler_exception_guard.test.cjs`
  - `tests/log_flush_level.test.cjs`
  - `tests/prismaui_api_reacquire.test.cjs`
  - `tests/prismaui_preload_cleanup.test.cjs`
  - `tests/registrationmaps_exists_error_code.test.cjs`

## 검증
- `for f in tests/*.cjs; do node "$f"; done` : PASS
- `export VCPKG_ROOT="/mnt/c/Users/kdw73/vcpkg" && cmake --preset wsl-debug` : PASS
- `export VCPKG_ROOT="/mnt/c/Users/kdw73/vcpkg" && cmake --build --preset wsl-debug` : PASS
- `ctest --test-dir build/wsl-debug --output-on-failure` : PASS
- `export VCPKG_ROOT="/mnt/c/Users/kdw73/vcpkg" && cmake --preset wsl-release` : PASS
- `export VCPKG_ROOT="/mnt/c/Users/kdw73/vcpkg" && cmake --build --preset wsl-release` : PASS
- `cmake --install build/wsl-release` : PASS
- `cd dist/CodexOfPowerNG && zip -r -FS "../../releases/Codex of Power NG.zip" .` : PASS

## 호환성/주의사항
- Codex of Power / SVCollection과 저장 호환되지 않습니다.
- 런타임 요구사항은 기존과 동일합니다:
  - SKSE64
  - Address Library for SKSE Plugins
  - Prisma UI
  - Media Keys Fix SKSE

## 패키지
- 배포 파일: `releases/Codex of Power NG.zip`
- 태그: `v1.0.8-rc.3`
- 릴리즈: https://github.com/servaltullius/CodexOfPowerNG/releases/tag/v1.0.8-rc.3
